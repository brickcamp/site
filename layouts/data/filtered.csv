{{- $filter := .Params.filter -}}

{{- $entries  := slice -}}
{{- range $tag, $weightedPages := site.Taxonomies.tags -}}
  {{- $tagSegments := partial "func/getTagSegments" $tag -}}

  {{- with $filter.base -}}
    {{- if ne . $tagSegments.base -}}
      {{- continue -}}
    {{- end -}}
  {{- end -}}

  {{- with $filter.type -}}
    {{- if ne . $tagSegments.type -}}
      {{- continue -}}
    {{- end -}}
  {{- end -}}

  {{- with $filter.value -}}
    {{- if ne . $tagSegments.value -}}
      {{- continue -}}
    {{- end -}}
  {{- end -}}

  {{- with $filter.notTypes -}}
    {{- if in . $tagSegments.type -}}
      {{- continue -}}
    {{- end -}}
  {{- end -}}

  {{- with $filter.notValues -}}
    {{- if in . $tagSegments.value -}}
      {{- continue -}}
    {{- end -}}
  {{- end -}}
  
  {{- range $weightedPages }}
    {{- $entry := print "'" .RelPermalink "'" -}}
    {{- $entries = $entries | append $entry -}}
  {{- end -}}
{{- end -}}

{{- $entries = sort $entries -}}
{{- $entries = $entries | uniq -}}
{{- range $entries -}}
{{ . }}
{{ end -}}