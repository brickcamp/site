{{- $filter := .Params.filter -}}

{{- $entries := slice -}}
{{- if eq $filter.from "tags" -}}
  {{- range $tag, $weightedPages := site.Taxonomies.tags -}}
    {{- $tagSegments := partial "func/getTagSegments" $tag -}}

    {{- with $filter.base -}}
      {{- if ne . $tagSegments.base -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- with $filter.type -}}
      {{- if ne . $tagSegments.type -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- with $filter.value -}}
      {{- if ne . $tagSegments.value -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- with $filter.notTypes -}}
      {{- if in . $tagSegments.type -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- with $filter.notValues -}}
      {{- if in . $tagSegments.value -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- range $weightedPages }}
      {{- $entries = $entries | append .Page -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- if eq $filter.from "size" -}}
  {{- $pages := where site.RegularPages "Section" "entries" -}}
  {{- range $pages -}}
    {{- $values   := partial "func/getPageValues" . -}}
    {{- $sizeType := index $values "_sizeType" | default "" -}}

    {{- with $filter.type -}}
      {{- if ne . $sizeType -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- with $filter.notTypes -}}
      {{- if in . $sizeType -}}
        {{- continue -}}
      {{- end -}}
    {{- end -}}

    {{- $entries = $entries | append . -}}
  {{- end -}}
{{- end -}}

{{- $entries = sort $entries -}}
{{- $entries = $entries | uniq -}}
{{- range $entries -}}
  {{- $copyright := print (time.Now.Format "2006") " BrickCamp" -}}
  {{- with (.Resources.GetMatch "image.*").Params.Copyright -}}
    {{- $copyright = . -}}
  {{- end -}}
  {{- $line := print .RelPermalink ",'" .Title "','" $copyright "'" -}}
{{ $line }}
{{ end -}}